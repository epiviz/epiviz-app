<!-- Polymer Dependency -->
<link rel="import" href="../../bower_components/polymer/polymer.html">

<!-- Polymer Elements -->
<link rel="import" href="../../bower_components/app-layout/app-layout.html">
<link rel="import" href="../../bower_components/app-route/app-location.html">
<link rel="import" href="../../bower_components/app-route/app-route.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-icons/av-icons.html">
<!-- <link rel="import" href="../../bower_components/iron-icon/iron-icon.html"> -->
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-progress/paper-progress.html">
<link rel="import" href="../../bower_components/paper-tooltip/paper-tooltip.html">

<!-- <link rel="import" href="../../bower_components/iron-media-query/iron-media-query.html"> -->

<!-- Epiviz Components -->
<!-- <link rel="import" href="../../bower_components/epiviz-data-source/epiviz-data-source.html"> -->
<link rel="import" href="../../bower_components/epiviz-workspace/epiviz-workspace.html">
<link rel="import" href="../../bower_components/epiviz-charts/epiviz-charts.html">

<!-- <link rel="import" href="../../bower_components/strand/dist/strand-tooltip/strand-tooltip.html"/> -->

<!-- default page home -->
<link rel="import" href="epiviz-home.html">

<dom-module id="epiviz-app">
  <template>
    <style>
      :host {
        display: block;
      }

      html, body {
        margin: 0;
        font-family: 'Roboto', 'Noto', sans-serif;
        -webkit-font-smoothing: antialiased;
        background: #f1f1f1;
        max-height: 368px;
      }

      app-toolbar {
        color: #4285f4;
        background-color: #efefef;
        --app-toolbar-font-size	: 15px;
        height: auto;
      }

      paper-icon-button {
        --paper-icon-button-ink-color: white;
      }

      paper-icon-button + [main-title] {
        margin-left: 24px;
      }

      paper-progress {
        display: block;
        width: 100%;
        --paper-progress-active-color: rgba(255, 255, 255, 0.5);
        --paper-progress-container-color: transparent;
      }

      app-header {
        @apply --layout-fixed-top;
        color: #fff;
        --app-header-background-rear-layer: {
          background-color: #ef6c00;
        };
      }

      app-header:not([shadow]) {
        border-bottom: 1px solid #ddd;
      }

      app-drawer {
        --app-drawer-scrim-background: rgba(0, 0, 100, 0.8);
        --app-drawer-content-container: {
          background-color: #B0BEC5;
        }
      }

      #epivizContent {
        padding-top: 60px;
      }

      .info {
        --iron-icon-width: 18px;
        --iron-icon-height: 18px;
      }

      paper-tooltip {
        z-index: 30001;
      }

      .headerActions {
        font-size: 15px;
        padding-left: 0px;
        float: left;
      }
    </style>

    <!-- TODO: Use routes int he future for loading workspacs and have a home page -->
    <app-location route="{{route}}"></app-location>
    <app-route
      route="{{route}}"
      pattern="/:workspace"
      data="{{routeData}}"
      tail="{{subroute}}">
    </app-route>

    <!-- <iron-media-query query="max-width: 400px" query-matches="{{smallScreen}}"></iron-media-query> -->

    <!-- default epiviz data provider -->
    <!-- TODO: have a UI to actually add this on the fly like select data providers to visualize,
          update when there's a new python version -->
    <app-header-layout>
      <app-header condenses>
        <app-toolbar>
          <a href="http://epiviz.github.io" target="_blank"><img src="../../images/epiviz_4_logo_medium.png" alt="Epiviz" width="100" height="21"></a>
          <!-- <paper-icon-button icon="menu" onclick="drawer.toggle()"></paper-icon-button> -->
          <paper-menu-button vertical-offset="50">
            <paper-button class="dropdown-trigger">
                <span>Add New Regions</span>
                <iron-icon icon="icons:arrow-drop-down"></iron-icon>
            </paper-button>
            <paper-listbox class="dropdown-content">
              <paper-item id="navBtn" on-click="_addNavigation">
                <img style="padding-right:5px" height="24px" width="24px" src="../../images/dna-scheme.svg"></img>
                <span> Genomic Region </span>
                <iron-icon class="info" id="navIcon" icon="icons:info-outline"></iron-icon>
                <!-- <strand-tooltip target="#navIcon">
                  <label>Adds a view element to visualize data from a region</label>
                </strand-tooltip> -->
                <paper-tooltip for="navIcon">Visualize data from a region</paper-tooltip>
              </paper-item>
              <paper-item id="ctnBtn" on-click="_addContainer">
                <img style="padding-right:5px" height="24px" width="24px" src="../../images/add-window-grid-symbol.svg"></img>
                <span>Genomic Container</span>
                <iron-icon class="info" id="ctnIcon" icon="icons:info-outline"></iron-icon>
                <!-- <strand-tooltip target="#ctnIcon">
                  <label>Adds a view element to visualize data from the entire dataset</label>
                </strand-tooltip> -->
                <paper-tooltip for="ctnIcon" position="top">Visualize data from the entire dataset</paper-tooltip>
              </paper-item>
            </paper-listbox>
          </paper-menu-button>

          <paper-button on-click="_addContainer">
            <iron-icon icon="icons:add-circle"></iron-icon>
            Add Container
          </paper-button>
          <paper-button on-click="_addNavigation">
            <iron-icon icon="av:library-add"></iron-icon> Add New Genomic Region
          </paper-button>
          <div main-title></div>
          <!-- <paper-icon-button icon="delete"></paper-icon-button>
          <paper-icon-button icon="search"></paper-icon-button>
          <paper-icon-button icon="close"></paper-icon-button> -->
          <!-- <paper-progress value="10" indeterminate bottom-item></paper-progress> -->
          <epiviz-workspace
            id="eWorkspace"
            auth-domain="epiviz-auth.firebaseapp.com"
            database-url="https://epiviz-auth.firebaseio.com/"
            api-key="AIzaSyAsys0gDGLxQ2H7XNYrvaf9OMkaAK1hfCw"
            storage-bucket="epiviz-auth.appspot.com"
            messaging-sender-id="688767774580"
            target-selector="#epivizContent"
          ></epiviz-workspace>
        </app-toolbar>
      </app-header>
      <div id="epivizContent">

      </div>
    </app-header-layout>
    <app-drawer id="drawer" swipe-open></app-drawer>
  </template>

  <script>
    /**
     * @customElement
     * @polymer
     */
    Polymer ({
      is : 'epiviz-app',
      properties: {
        routeWorkspace: {
          type: String,
          notify: true,
          observer: '_onRouteWorkspaceChanged'
        }
      },

      observers: [
        "_onRouteData(routeData.workspace)"
      ],

      listeners: {
      },

      _onRouteWorkspaceChanged: function(newVal, oldVal) {
        this.set("routeData.workspace", this.routeWorkspace);
      },

      _onRouteData: function(ws) {
        $("#epivizContent").empty();
        // this.$.eWorkspace.loadWorkSpaceId(ws);
      },

      _addContainer: function() {
        var self = this;

        var elem = document.createElement("epiviz-environment");
        // TODO: Ask user for the location to start the element at.
        // elem.setAttribute("chr", "chr11");
        // elem.setAttribute("start", 3947953);
        // elem.setAttribute("end", 7164991);
        elem.setAttribute("no-logo", true);
        self.$.epivizContent.append(elem);
      },

      _addNavigation: function() {
        var self = this;

        var elem = document.createElement("epiviz-navigation");
        // TODO: Ask user for the location to start the element at.
        elem.setAttribute("chr", "chr11");
        elem.setAttribute("start", 3947953);
        elem.setAttribute("end", 7164991);
        elem.setAttribute("no-logo", true);
        self.$.epivizContent.append(elem);
      }
    });
  </script>
</dom-module>
